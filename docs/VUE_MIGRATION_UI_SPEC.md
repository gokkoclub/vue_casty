# 詳細UI/UX仕様書 - Vue移行用

> **最終更新**: 2026-01-26
> **対象**: 全画面のレイアウト・ボタン配置・操作仕様・プログレスバー使用箇所

---

## 📋 目次

1. [グローバルUI要素](#1-グローバルui要素)
2. [キャスティング画面](#2-キャスティング画面-casting-view)
3. [キャスティング状況画面](#3-キャスティング状況画面-status-view)
4. [撮影連絡管理画面](#4-撮影連絡管理画面-management-view)
5. [モーダル一覧](#5-モーダル一覧)
6. [プログレスバー仕様](#6-プログレスバー仕様)
7. [Firebase/Firestore移行時の考慮事項](#7-firebasefirestore移行時の考慮事項)

---

## 1. グローバルUI要素

### 1.1 ヘッダー（sticky top-0）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ キャスト管理システム ✨     [キャストを探す] [キャスティング状況] [管理画面]   👤(0) 🔓 │
└─────────────────────────────────────────────────────────────────────────┘
```

| 要素 | 配置 | 動作 |
|-----|------|------|
| ロゴ | 左端 | クリック不可（装飾のみ） |
| ナビゲーションタブ | 中央 | アクティブタブ = `border-b-2 border-blue-600 text-blue-600` |
| カートアイコン | 右寄り | クリックでカートモーダル表示、バッジに件数表示 |
| サインイン/アウト | 右端 | Google OAuth認証 |

### 1.2 モバイルメニュー（md:hidden）
- ハンバーガーボタン→クリックで縦積みメニュー展開
- 同じナビゲーション項目＋サインインボタン

### 1.3 グローバルローダー
```html
<div id="loader" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
  <!-- スピナー + "データを読み込んでいます..." -->
</div>
```
- **表示タイミング**: ページ初期ロード、リフレッシュ時
- **関数**: `showLoader(true/false)`

### 1.4 メッセージボックス（トースト）
```html
<div id="message-box" class="hidden fixed top-20 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg z-50">
```
- **色分け**: 
  - 成功 = `bg-green-500`
  - 警告 = `bg-yellow-500`
  - エラー = `bg-red-500`
- **関数**: `showMessage(message, type)`
- **自動消去**: 3秒後

---

## 2. キャスティング画面 (`casting-view`)

### 2.1 レイアウト構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ┌───────────────────┐  ┌──────────────────────────────────────────────┐│
│ │                   │  │ 3. キャストを選択              [3列][5列]  ││
│ │  1. 日付を選択    │  ├──────────────────────────────────────────────┤│
│ │  [◀][2026年1月][▶]│  │ [性別] [事務所▼] [フリーワード] [未仮キャス] ││
│ │  日 月 火 水 木...│  │ [出演回数順] [50音順]                       ││
│ │  ■  2  3  4  5...│  ├──────────────────────────────────────────────┤│
│ │                   │  │ 選択中: 2026/1/15                           ││
│ │  ───────────────  │  ├──────────────────────────────────────────────┤│
│ │  2. 撮影を選択    │  │ ┌────────┐ ┌────────┐ ┌────────┐           ││
│ │  ○ 案件A (1/15)   │  │ │+新規   │ │キャスト│ │キャスト│           ││
│ │  ○ 案件B (1/15)   │  │ │外部作成│ │Card   │ │Card   │            ││
│ │                   │  │ └────────┘ └────────┘ └────────┘           ││
│ └───────────────────┘  └──────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 カレンダー操作仕様

| 操作 | 動作 |
|-----|------|
| 日付クリック | 選択トグル（複数選択可）、選択済み = `bg-blue-500 text-white rounded-full` |
| 今日 | `border border-red-500` |
| `◀` / `▶` | 月切り替え |
| 日付選択時 | `selectedDates`配列に追加→`displayAvailableCasts()`自動呼び出し |

### 2.3 撮影リスト（Notionから取得）

| 状態 | 表示 |
|-----|------|
| 日付未選択 | "日付を選択すると、候補の撮影が表示されます。" |
| 選択済み | 該当日の撮影リスト（ラジオボタン） |
| クリック時 | `selectedShooting`に設定、`updateCartFromShooting()`呼び出し |

### 2.4 フィルター仕様

```
┌──────────────────────────────────────────────────────────────────┐
│ [性別]          [事務所▼]    [フリーワード]  [未仮キャスのみ]   │
│ ☐男性 ☐女性   選択...      [_____________] ☐                  │
│                                              [出演回数順][50音順]│
└──────────────────────────────────────────────────────────────────┘
```

| フィルター | 動作 |
|-----------|------|
| 性別 | チェックボックス（複数選択可）、未選択時は全表示 |
| 事務所 | ドロップダウン複数選択、「選択...」ボタン→チェックリスト |
| フリーワード | 即時フィルタ（名前・事務所・メモを検索） |
| 未仮キャスのみ | チェック時、仮キャスティング中のキャストを非表示 |
| 出演回数順 | 降順ソート（排他的、50音順と同時選択不可） |
| 50音順 | 名前で昇順ソート（排他的） |

### 2.5 キャストカード

```
┌─────────────────────┐
│ [画像         ]  🔴 ← ステータスバッジ（右上）
│                    │  
├─────────────────────┤
│ 名前               │
│ 事務所             │
│ 男性 / 28歳 / 5回  │
├─────────────────────┤
│ [仮キャスティング] │ ← ボタン
│ ※別件の撮影があり │ ← 警告テキスト（条件付き表示）
└─────────────────────┘
```

**ステータスバッジ:**
| 状態 | バッジ | ボタン | カード透明度 |
|-----|--------|--------|-------------|
| 空き | なし | 「仮キャスティング」(青) | 100% |
| 決定 | 🔴 `TeamA 決定` (赤) | 「仮キャスティング追加」 | 100% |
| 仮押さえ | 🟡 `TeamA 仮押さえ` (黄) | 「仮キャスティング」 | 100% |
| 撮影稼働あり | 🔵 `撮影稼働あり` (シアン) | 「仮キャスティング」 | 100% |
| NG | ⚫ `NG` (グレー) | disabled | 50% |
| カートに追加済み | - | disabled「追加済み」 | 50% |

**操作:**
- カードクリック → キャスト詳細モーダル
- ボタンクリック → カートに追加

### 2.6 ビューモード切り替え（3列/5列）

```html
<button id="view-mode-comfort">3列</button>  <!-- アクティブ時: bg-blue-500 text-white -->
<button id="view-mode-dense">5列</button>
```

| モード | CSSクラス |
|-------|----------|
| 3列(comfort) | `grid-cols-1 md:grid-cols-2 xl:grid-cols-3` |
| 5列(dense) | `grid-cols-2 md:grid-cols-3 xl:grid-cols-5` |

---

## 3. キャスティング状況画面 (`status-view`)

### 3.1 レイアウト構成

```
┌──────────────────────────────────────────────────────────────────────────┐
│ キャスティング状況                                                        │
├──────────────────────────────────────────────────────────────────────────┤
│ [🎬 通常キャスティング] [🏢 外部案件・社内イベント]    ← タブ切り替え     │
├──────────────────────────────────────────────────────────────────────────┤
│ [◀] 2026年1月 [▶]   ☐オーダー待ちのみ  ☐過去を表示  [再読込]            │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ ▼ 2026/01/15 (水)                                    ← 日付ヘッダー     │
│   ├─ TeamA                                                               │
│   │   └─ 作品名A                                                         │
│   │       ├─ キャスト1 [決定]     役名   ランク1   [編集] [追加オーダー] │
│   │       └─ キャスト2 [打診中]   役名   ランク2   [編集] [追加オーダー] │
│   └─ TeamB                                                               │
│       └─ 作品名B                                                         │
│           └─ ...                                                         │
│                                                                          │
│ ▼ 2026/01/16 (木)                                                       │
│   └─ ...                                                                 │
└──────────────────────────────────────────────────────────────────────────┘
```

### 3.2 ソート・フィルタ仕様 ⚠️重要

| 仕様 | 詳細 |
|-----|------|
| **日付順序** | 若い日付順（昇順）、例: 1/15 → 1/16 → 1/17 |
| **月範囲** | 当月のみ表示（1日〜末日） |
| **過去非表示（デフォルト）** | `showPast = false`の時、今日より前の日付は非表示 |
| **オーダー待ちのみ** | チェック時、status = 'オーダー待ち' のレコードがある日付のみ表示 |
| **タブ切り替え** | 「通常」= 外部案件・社内イベント以外、「特別」= 外部案件・社内イベントのみ |

### 3.3 タブ仕様

| タブ | accountNameフィルタ |
|-----|---------------------|
| 🎬 通常キャスティング | `!= '外部案件' && != '社内イベント'` |
| 🏢 外部案件・社内イベント | `== '外部案件' || == '社内イベント'` |

### 3.4 ステータス色分け

| ステータス | 背景色 | テキスト色 |
|-----------|--------|-----------|
| 仮キャスティング | `bg-gray-200` | `text-gray-700` |
| 仮押さえ | `bg-yellow-200` | `text-yellow-800` |
| 打診中 | `bg-blue-200` | `text-blue-800` |
| オーダー待ち | `bg-purple-200` | `text-purple-800` |
| OK | `bg-green-200` | `text-green-800` |
| 決定 | `bg-green-500` | `text-white` |
| 条件つきOK | `bg-orange-200` | `text-orange-800` |
| NG | `bg-red-500` | `text-white` |
| キャンセル | `bg-gray-400` | `text-white` |

### 3.5 行クリック操作

| クリック位置 | 動作 |
|-------------|------|
| ステータスバッジ | ステータスクイック変更モーダル |
| 行全体 | 編集モーダル |
| [追加オーダー]ボタン | 同じスレッドに追加オーダー |
| [まとめ]ボタン | キャスティングまとめモーダル（コピー用） |

---

## 4. 撮影連絡管理画面 (`management-view`)

### 4.1 レイアウト構成

```
┌──────────────────────────────────────────────────────────────────────────┐
│ 撮影連絡管理                                                              │
├──────────────────────────────────────────────────────────────────────────┤
│ [1.香盤連絡待ち] [2.発注書送信待ち] [3.メイキング共有待ち] [4.投稿日連絡] │
├──────────────────────────────────────────────────────────────────────────┤
│ [GAS同期ボタン]  ← タブによって異なるボタン表示                          │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ ▼ 2026/01/15 (水)                        ← アコーディオン（日付）       │
│   ▼ TeamA / 作品名A                      ← アコーディオン（案件）       │
│     ┌────────────────────────────────────────────────────────────┐       │
│     │ キャスト | 役名 | IN | OUT | 場所 | 金額 | [保存] [メール]│       │
│     ├────────────────────────────────────────────────────────────┤       │
│     │ 田中太郎 | 主役 |10:00|18:00| 渋谷 | ¥50,000 | [💾][📧]   │       │
│     │ 山田花子 | ゲスト|    |     |      |         | [💾][📧]   │       │
│     └────────────────────────────────────────────────────────────┘       │
└──────────────────────────────────────────────────────────────────────────┘
```

### 4.2 タブ別仕様

| タブ | ステータス | 同期ボタン | 特記 |
|-----|-----------|-----------|------|
| 1. 香盤連絡待ち | `香盤連絡待ち` | 「スケジュール同期」(GAS) | IN/OUT/場所編集可 |
| 2. 発注書送信待ち | `発注書送信待ち` | 「Notion同期」(GAS) | PDF発注書作成ボタン |
| 3. メイキング共有待ち | `メイキング共有待ち` | - | メイキングURL編集可 |
| 4. 投稿日連絡待ち | `投稿日連絡待ち` | 「撮影日程同期」(GAS) | 投稿日編集可 |

### 4.3 インライン編集フィールド

| フィールド | タイプ | 保存タイミング |
|-----------|--------|---------------|
| IN時間 | `<input type="text">` | blur時またはボタン押下 |
| OUT時間 | `<input type="text">` | blur時またはボタン押下 |
| 場所 | `<input type="text">` | blur時またはボタン押下 |
| 住所 | `<input type="text">` | blur時またはボタン押下 |
| 金額 | `<input type="text">` | blur時またはボタン押下 |
| メイキングURL | `<input type="text">` | blur時またはボタン押下 |
| 投稿日 | `<input type="text">` | blur時またはボタン押下 |

### 4.4 行アクションボタン

| ボタン | 動作 |
|--------|------|
| 💾 保存 | 行データをAPI経由で保存 |
| 📧 メール | メール作成モーダル表示 |
| 📄 発注書 | PDF発注書作成モーダル（発注書タブのみ） |
| ステータス変更 | 次のタブへ移動（確認あり） |

---

## 5. モーダル一覧

### 5.1 カートモーダル（2ステップ）

**Step 1: キャスト割り当て**
```
┌─────────────────────────────────────────────────────────────────┐
│ [×]  カート (ステップ 1/2)                                       │
├─────────────────────────────────────────────────────────────────┤
│ 撮影日: 2026/01/15〜2026/01/16                                  │
│ 撮影: 【案件A】作品名                                            │
│ Notion: [リンク]                                                 │
│                                                                  │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 選択したキャスト一覧（ドラッグで並び替え）                    │ │
│ │ ┌─────────────────┐                                          │ │
│ │ │ 1. 田中太郎 [×] │ ← ドラッグハンドル + 削除ボタン         │ │
│ │ │ 2. 山田花子 [×] │                                          │ │
│ │ └─────────────────┘                                          │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                  │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ プロジェクト1                                          [−]  │ │
│ │ [作品名入力]                                                 │ │
│ │   役名1: [________] 種別: [メイン▼] ノート: [___]           │ │
│ │   → ドロップゾーン（キャストをここにドロップ）              │ │
│ │   [+ 役を追加]                                               │ │
│ │ [+ プロジェクトを追加]                                       │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                  │
│                                          [キャンセル] [次へ →]  │
└─────────────────────────────────────────────────────────────────┘
```

**Step 2: 確認**
```
┌─────────────────────────────────────────────────────────────────┐
│ [×]  確認 (ステップ 2/2)                                         │
├─────────────────────────────────────────────────────────────────┤
│ アカウント: TeamA                                                │
│ 撮影日: 2026/01/15〜2026/01/16                                  │
│                                                                  │
│ ■ 作品名A                                                        │
│   ├─ 主役: 田中太郎 (ランク1) [メイン]                          │
│   └─ ゲスト: 山田花子 (ランク2) [サブ]                          │
│                                                                  │
│ ☐ 親密表現あり                                                   │
│                                                                  │
│ PDF添付: [ファイルを選択]  ← 複数ファイル選択可                 │
│                                                                  │
│                                  [← 戻る] [キャンセル] [送信]   │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 ステータスクイック変更モーダル

```
┌──────────────────────────────────────────────────┐
│ ステータス変更                              [×]  │
├──────────────────────────────────────────────────┤
│ TeamA / 作品名A / 田中太郎                        │
│ 現在のステータス: 打診中                          │
│                                                   │
│ 新しいステータス:                                 │
│ [仮キャスティング] [打診中] [OK] [決定] [NG]     │
│ [条件つきOK] [キャンセル]                        │
│                                                   │
│ 金額（税別）: ※OK/決定選択時のみ表示             │
│ [______________] 円                              │
│                                                   │
│ メッセージ（任意）: ※条件つきOK選択時のみ表示   │
│ [__________________________________]             │
│                                                   │
│                          [キャンセル] [変更する] │
└──────────────────────────────────────────────────┘
```

### 5.3 キャスト詳細モーダル

```
┌──────────────────────────────────────────────────┐
│ キャスト詳細                                [×]  │
├──────────────────────────────────────────────────┤
│ ┌────────────────────────────────────────────┐  │
│ │            [キャスト画像]                  │  │
│ └────────────────────────────────────────────┘  │
│                                                   │
│ 名前: 田中太郎                                   │
│ 事務所: 〇〇プロ                                 │
│ 性別: 男性                                       │
│ 年齢: 28歳                                       │
│ 出演回数: 5回                                    │
│ SlackID: @tanaka                                 │
│ キャストタイプ: 外部                             │
│                                                   │
│ 備考:                                            │
│ [備考テキスト...]                                │
│                                                   │
│                    [閉じる] [仮キャスティング]   │
└──────────────────────────────────────────────────┘
```

### 5.4 メール作成モーダル

```
┌──────────────────────────────────────────────────────────────┐
│ メール作成                                              [×]  │
├──────────────────────────────────────────────────────────────┤
│ タブ: [香盤連絡] [発注書送付]                                │
├──────────────────────────────────────────────────────────────┤
│ 件名:                                                        │
│ [【撮影依頼】作品名A / 田中太郎様_________________________] │
│                                                              │
│ 本文:                                                        │
│ ┌──────────────────────────────────────────────────────────┐│
│ │田中太郎 様                                               ││
│ │                                                          ││
│ │お世話になっております。                                  ││
│ │下記の撮影についてご連絡いたします。                      ││
│ │                                                          ││
│ │■ 案件名                                                  ││
│ │TeamA / 作品名A                                           ││
│ │                                                          ││
│ │■ 役名                                                    ││
│ │主役                                                      ││
│ │...                                                       ││
│ └──────────────────────────────────────────────────────────┘│
│                                                              │
│           [クリップボードにコピー] [mailto:で開く]          │
└──────────────────────────────────────────────────────────────┘
```

### 5.5 PDF発注書モーダル

```
┌──────────────────────────────────────────────────────────────┐
│ 発注書作成                                              [×]  │
├──────────────────────────────────────────────────────────────┤
│ 発注先: 〇〇プロダクション 御中                              │
│ 対象者: 田中太郎 様                                          │
│                                                              │
│ ┌──────────────────────────────────────────────┐            │
│ │ [PDFプレビュー]                              │            │
│ │                                              │            │
│ │  発 注 書                                    │            │
│ │  〇〇プロダクション 御中                     │            │
│ │                                              │            │
│ │  ...                                         │            │
│ └──────────────────────────────────────────────┘            │
│                                                              │
│                          [キャンセル] [PDFダウンロード]      │
└──────────────────────────────────────────────────────────────┘
```

---

## 6. プログレスバー仕様

### 6.1 プログレスモーダル

```html
<div id="progress-modal" class="hidden fixed inset-0 z-[90] ...">
  <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
    <h3 id="progress-title">処理中...</h3>
    <p id="progress-message">しばらくお待ちください</p>
    <div class="w-full bg-gray-200 rounded-full h-4">
      <div id="progress-bar-fill" class="bg-blue-600 h-4 rounded-full" style="width: 0%"></div>
    </div>
    <div id="progress-percent">0%</div>
  </div>
</div>
```

### 6.2 使用箇所一覧

| 操作 | プログレス表示 | ステップ |
|-----|---------------|---------|
| **オーダー送信** | ✅ あり | 10%: 開始 → 30%: Slack送信中 → 60%: シート書き込み → 80%: カレンダー登録 → 100%: 完了 |
| **特別オーダー送信** | ✅ あり | 10%: 開始 → 50%: API呼び出し → 80%: カレンダー登録 → 100%: 完了 |
| **ステータス変更** | ❌ なし | ローダー表示のみ |
| **データ再読込** | ❌ なし | ローダー表示のみ |
| **GAS同期** | ✅ ボタン内 | ボタンテキスト「同期中...」に変更 |

### 6.3 関数仕様

```javascript
function showProgressBar(message = "処理中...", percent = 0) {...}
function updateProgressBar(message, percent) {...}
function hideProgressBar() {...}
```

---

## 7. Firebase/Firestore移行時の考慮事項

### 7.1 PDF添付ファイルの保存

**現行**: 
- Slack APIの`files_upload_v2`で直接アップロード
- PDFはSlackに保存され、スプレッドシートには参照なし

**Firestore移行案**:

```
┌─────────────────────────────────────────────────────────────────────┐
│ Option A: Firebase Storage + Firestore参照                          │
├─────────────────────────────────────────────────────────────────────┤
│ 1. フロントエンド → Firebase Storage (gs://bucket/orders/{id}/*)    │
│ 2. アップロード完了後、Firestore castings/{id} に storageUrls 保存   │
│ 3. Slack通知時、Cloud FunctionがStorageからダウンロードして送信     │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│ Option B: Slack直接アップロード維持                                 │
├─────────────────────────────────────────────────────────────────────┤
│ 1. 現行通りバックエンド経由でSlackにアップロード                   │
│ 2. 返ってきたfile_idをFirestore castings/{id} に保存               │
│ 3. PDFはSlack側に保存、Firestoreは参照のみ保持                     │
└─────────────────────────────────────────────────────────────────────┘
```

**推奨**: Option B（Slack直接維持）
- 理由: 現行フローを維持でき、移行リスクが低い
- PDFはSlackスレッドに添付された状態で使われる用途が多い

### 7.2 Firestoreデータモデル

```typescript
// collections/castings/{id}
{
  castingId: string,
  accountName: string,
  projectName: string,
  projectId: string, // Notion Page ID
  ...
  // PDF関連
  slackFileIds: string[], // Slackにアップロード済みのファイルID
  storageUrls?: string[], // Option A採用時のFirebase Storage URL
}
```

### 7.3 発注書PDF（ブラウザ生成）

**現行**: jsPDFでブラウザ側生成 → ダウンロード or Firebase Storage保存

**移行後も維持可能**:
```javascript
// 発注書PDFはFirebase Storageに保存し、Firestoreに参照を保持
async function saveOrderDocument(castingId, pdfBlob) {
  const storageRef = ref(storage, `order_documents/${castingId}/${uuid}.pdf`);
  await uploadBytes(storageRef, pdfBlob);
  const url = await getDownloadURL(storageRef);
  
  // Firestoreに参照保存
  await updateDoc(doc(db, 'castings', castingId), {
    orderDocumentUrl: url,
    orderDocumentCreatedAt: serverTimestamp()
  });
}
```

---

## 付録: Tailwind CSSクラス対応表

### ボタンスタイル

| 種類 | クラス |
|-----|--------|
| プライマリ | `bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg` |
| セカンダリ | `bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg` |
| 成功 | `bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded` |
| 警告 | `bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded` |
| 危険 | `bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded` |
| アウトライン | `border border-gray-300 text-gray-700 hover:bg-gray-50 px-4 py-2 rounded` |
| disabled | `bg-gray-400 cursor-not-allowed` |

### カード

```css
.card {
  @apply bg-white rounded-lg shadow-md overflow-hidden;
}
.card-hover {
  @apply hover:shadow-lg transition-shadow;
}
```

### モーダル

```css
.modal-backdrop {
  @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
}
.modal-content {
  @apply bg-white rounded-lg shadow-xl p-6 w-full max-w-lg;
}
```
