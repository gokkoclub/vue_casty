# æ’®å½±é€£çµ¡ãƒšãƒ¼ã‚¸ä»•æ§˜æ›¸

**æ›´æ–°æ—¥:** 2026å¹´2æœˆ19æ—¥

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹](#2-ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹)
3. [ãƒšãƒ¼ã‚¸æ§‹æˆã¨UI](#3-ãƒšãƒ¼ã‚¸æ§‹æˆã¨ui)
4. [ã‚¿ãƒ–åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ä»•æ§˜](#4-ã‚¿ãƒ–åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ä»•æ§˜)
5. [ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»](#5-ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»)
6. [ãƒ¡ãƒ¼ãƒ«ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«](#6-ãƒ¡ãƒ¼ãƒ«ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«)
7. [GASåŒæœŸæ©Ÿèƒ½](#7-gasåŒæœŸæ©Ÿèƒ½)
8. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API](#8-ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰api)
9. [ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒˆãƒªã‚¬ãƒ¼](#9-ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒˆãƒªã‚¬ãƒ¼)

---

## 1. æ¦‚è¦

æ’®å½±é€£çµ¡ãƒšãƒ¼ã‚¸ã¯ã€æ’®å½±æ±ºå®šå¾Œã®ã‚­ãƒ£ã‚¹ãƒˆã¸ã®å„ç¨®é€£çµ¡ã‚’ç®¡ç†ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒšãƒ¼ã‚¸ã€‚ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€Œæ’®å½±é€£çµ¡ã€ãƒœã‚¿ãƒ³ï¼ˆ`management-view`ï¼‰ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚

4æ®µéšã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¯¾å¿œã™ã‚‹4ã¤ã®ã‚¿ãƒ–ã§æ§‹æˆã•ã‚Œã€å„ã‚¿ãƒ–ã«ãƒ¡ãƒ¼ãƒ«ä½œæˆãƒ»é€ä¿¡æ”¯æ´æ©Ÿèƒ½ã‚’æŒã¤ã€‚

```mermaid
flowchart LR
    A[é¦™ç›¤é€£çµ¡å¾…ã¡] --> B[ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡]
    B --> C[ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡]
    C --> D[æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡]
    D --> E[å®Œäº†]
```

---

## 2. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

### ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ

| é …ç›® | å€¤ |
|---|---|
| **ã‚·ãƒ¼ãƒˆID** | ç’°å¢ƒå¤‰æ•° `SHOOTING_CONTACT_SHEET_ID` |
| **ã‚·ãƒ¼ãƒˆå** | `æ’®å½±é€£çµ¡DB` |

### åˆ—æ§‹æˆï¼ˆAã€œUåˆ—ï¼‰

| åˆ— | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | èª¬æ˜ |
|---|---|---|---|
| A | 0 | `castingId` | ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚°IDï¼ˆä¸»ã‚­ãƒ¼ï¼‰ |
| B | 1 | `accountName` | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå |
| C | 2 | `projectName` | ä½œå“å |
| D | 3 | `notionId` | Notion Page ID |
| E | 4 | `roleName` | å½¹å |
| F | 5 | `castName` | ã‚­ãƒ£ã‚¹ãƒˆå |
| G | 6 | `castType` | ã‚­ãƒ£ã‚¹ãƒˆç¨®åˆ¥ï¼ˆå†…éƒ¨/å¤–éƒ¨ï¼‰ |
| H | 7 | `shootDate` | æ’®å½±æ—¥ |
| I | 8 | `note` | å‚™è€ƒ |
| J | 9 | `status` | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| K | 10 | `inTime` | INæ™‚é–“ |
| L | 11 | `outTime` | OUTæ™‚é–“ |
| M | 12 | `location` | å ´æ‰€ |
| N | 13 | `address` | ä½æ‰€ |
| O | 14 | `makingUrl` | ãƒ¡ã‚¤ã‚­ãƒ³ã‚°URL |
| P | 15 | `cost` | é‡‘é¡ |
| Q | 16 | `postDate` | æŠ•ç¨¿æ—¥ |
| R | 17 | `updatedBy` | æ›´æ–°è€… |
| S | 18 | `updatedAt` | æ›´æ–°æ—¥æ™‚ |
| T | 19 | `mainSub` | åŒºåˆ†ï¼ˆãƒ¡ã‚¤ãƒ³/ã‚µãƒ–/ãã®ä»–ï¼‰ |
| U | 20 | `poUuid` | ç™ºæ³¨æ›¸UUID |

---

## 3. ãƒšãƒ¼ã‚¸æ§‹æˆã¨UI

### è¡¨ç¤ºãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant FE as ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    participant API as ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
    participant Sheet as æ’®å½±é€£çµ¡DB

    User->>FE: ã€Œæ’®å½±é€£çµ¡ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
    FE->>FE: showShootContactPage()
    FE->>API: GET /api/shooting_contact/list
    API->>Sheet: get_all_values()
    Sheet-->>API: å…¨è¡Œãƒ‡ãƒ¼ã‚¿
    API-->>FE: JSONé…åˆ—
    FE->>FE: currentContactTabã§ãƒ•ã‚£ãƒ«ã‚¿
    FE->>FE: æ—¥ä»˜â†’ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/ä½œå“ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
    FE->>FE: ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³UIæç”»
```

### 4ã‚¿ãƒ–æ§‹æˆ

| ã‚¿ãƒ– | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å€¤ | åŒæœŸãƒœã‚¿ãƒ³ |
|---|---|---|
| 1. é¦™ç›¤é€£çµ¡å¾…ã¡ | `é¦™ç›¤é€£çµ¡å¾…ã¡` | ğŸ”„ é¦™ç›¤DBã¨åŒæœŸ |
| 2. ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡ | `ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡` | ãªã— |
| 3. ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡ | `ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡` | ğŸ¬ ãƒ¡ã‚¤ã‚­ãƒ³ã‚°DBã¨åŒæœŸ |
| 4. æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡ | `æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡` | ğŸ“… æŠ•ç¨¿æ—¥DBã¨åŒæœŸ |

### ãƒ‡ãƒ¼ã‚¿ã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°

1. `status` ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆé¸æŠã‚¿ãƒ–ã«ä¸€è‡´ã™ã‚‹ã‚‚ã®ã®ã¿ï¼‰
2. **ç¬¬1éšå±¤**: æ’®å½±æ—¥ï¼ˆ`shootDate`ï¼‰ã§æ—¥ä»˜ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã€‚æŠ•ç¨¿æ—¥ã‚¿ãƒ–ã®ã¿ `postDate` ã‚’ä½¿ç”¨
3. **ç¬¬2éšå±¤**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå + NotionIDï¼ˆã¾ãŸã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼‰ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
4. å„ã‚°ãƒ«ãƒ¼ãƒ—ãŒã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰ã§è¡¨ç¤º

```
ğŸ“… æ’®å½±æ—¥: 2025-03-15
  ğŸ¢ ãƒãƒ¼ãƒ A / ğŸ¬ ä½œå“åX (3å)
    [ãƒ†ãƒ¼ãƒ–ãƒ«: ã‚­ãƒ£ã‚¹ãƒˆä¸€è¦§]
  ğŸ¢ ãƒãƒ¼ãƒ B / ğŸ¬ ä½œå“åY (2å)
    [ãƒ†ãƒ¼ãƒ–ãƒ«: ã‚­ãƒ£ã‚¹ãƒˆä¸€è¦§]
ğŸ“… æ’®å½±æ—¥: 2025-03-16
  ...
```

---

## 4. ã‚¿ãƒ–åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ä»•æ§˜

### å…±é€šã‚«ãƒ©ãƒ 

| ãƒ˜ãƒƒãƒ€ãƒ¼ | å†…å®¹ |
|---|---|
| æ¡ˆä»¶å / å½¹å | `projectName` + `roleName` |
| ã‚­ãƒ£ã‚¹ãƒˆ | `castName` |
| M/S | `mainSub`ï¼ˆãƒ¡ã‚¤ãƒ³/ã‚µãƒ–/ãã®ä»–ï¼‰ |

### ã‚¿ãƒ–å›ºæœ‰ã®ã‚«ãƒ©ãƒ ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

#### 1. é¦™ç›¤é€£çµ¡å¾…ã¡

| è¿½åŠ ã‚«ãƒ©ãƒ  | å†…å®¹ | ç·¨é›† |
|---|---|---|
| æ—¥æ™‚/å ´æ‰€ | IN/OUTæ™‚é–“ + å ´æ‰€ | âœ… ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› |
| é‡‘é¡ | `cost` | âœ… ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› |

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³:**
- ğŸ’¾ ä¿å­˜ â†’ `saveShootingRow()` â†’ `POST /api/shooting_contact/update`
- âœ‰ï¸ ä½œæˆ â†’ `openShootMailModal()` â†’ ãƒ¡ãƒ¼ãƒ«ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«

#### 2. ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡

| è¿½åŠ ã‚«ãƒ©ãƒ  | å†…å®¹ | ç·¨é›† |
|---|---|---|
| æ—¥æ™‚/å ´æ‰€ | IN/OUTæ™‚é–“ + å ´æ‰€ | âœ… ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› |
| é‡‘é¡ | `cost` | âœ… ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› |

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³:**
- ğŸ’¾ ä¿å­˜ â†’ `saveShootingRow()`
- ğŸ“„ ç™ºæ³¨æ›¸ â†’ `openOrderDocModal()` â†’ ç™ºæ³¨æ›¸PDFä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«
- âœ‰ï¸ ä½œæˆ â†’ `openShootMailModal()`

#### 3. ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡

| è¿½åŠ ã‚«ãƒ©ãƒ  | å†…å®¹ | ç·¨é›† |
|---|---|---|
| ãƒ¡ã‚¤ã‚­ãƒ³ã‚°URL | `makingUrl` | âŒ ãƒªãƒ³ã‚¯è¡¨ç¤ºã®ã¿ |

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³:**
- âœ‰ï¸ ä½œæˆ â†’ `openShootMailModal()`

#### 4. æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡

| è¿½åŠ ã‚«ãƒ©ãƒ  | å†…å®¹ | ç·¨é›† |
|---|---|---|
| æŠ•ç¨¿æ—¥ | `postDate` | âŒ ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã®ã¿ |

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³:**
- âœ‰ï¸ ä½œæˆ â†’ `openShootMailModal()`

### ä¿å­˜å‡¦ç†ã®è©³ç´° (`saveShootingRow`)

```javascript
// è¡Œå†…ã®inputã‹ã‚‰å€¤ã‚’å–å¾—
const inTime = row.querySelector('.shoot-in')?.value;
const outTime = row.querySelector('.shoot-out')?.value;
const location = row.querySelector('.shoot-location')?.value;
const cost = row.querySelector('.shoot-cost')?.value;

// APIå‘¼ã³å‡ºã—
await fetch("/api/shooting_contact/update", {
  method: "POST",
  body: JSON.stringify({ castingId, inTime, outTime, location, cost })
});
```

---

## 5. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»

### è‡ªå‹•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é€²è¡Œ

ãƒ¡ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã€Œã‚³ãƒ”ãƒ¼ã—ã¦é–‰ã˜ã‚‹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ï¼‰ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æœ¬æ–‡ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã€**è‡ªå‹•çš„ã«æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¸é€²ã‚€**ã€‚

```mermaid
stateDiagram-v2
    [*] --> é¦™ç›¤é€£çµ¡å¾…ã¡: DBç™»éŒ²æ™‚
    é¦™ç›¤é€£çµ¡å¾…ã¡ --> ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡: âœ‰ï¸ã‚³ãƒ”ãƒ¼ã—ã¦é–‰ã˜ã‚‹
    ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡ --> ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡: âœ‰ï¸ã‚³ãƒ”ãƒ¼ã—ã¦é–‰ã˜ã‚‹
    ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡ --> æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡: âœ‰ï¸ã‚³ãƒ”ãƒ¼ã—ã¦é–‰ã˜ã‚‹
    æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡ --> å®Œäº†: âœ‰ï¸ã‚³ãƒ”ãƒ¼ã—ã¦é–‰ã˜ã‚‹
```

### é·ç§»ãƒ­ã‚¸ãƒƒã‚¯ (`copyToClipboardAndClose`)

| ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | æ›´æ–°å…ˆ |
|---|---|---|
| é¦™ç›¤é€£çµ¡å¾…ã¡ | ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡ | æ’®å½±é€£çµ¡DBï¼ˆ`/api/shooting_contact/update`ï¼‰ |
| ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡ | ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡ | æ’®å½±é€£çµ¡DB |
| ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡ | æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡ | æ’®å½±é€£çµ¡DB + **ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿åŒæœŸ** |
| æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡ | å®Œäº† | æ’®å½±é€£çµ¡DB |
| ã‚ªãƒ¼ãƒ€ãƒ¼å¾…ã¡ / æ‰“è¨ºä¸­ / ä»®ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚° | æ‰“è¨ºä¸­ | ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚¹ãƒˆï¼ˆ`changeCastingStatus()`ï¼‰ |

> [!IMPORTANT]
> `ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡ â†’ æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡` ã®é·ç§»æ™‚ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã§ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã® Påˆ—ï¼ˆpoUuidï¼‰ã¨ Oåˆ—ï¼ˆcostï¼‰ã‚‚åŒæœŸæ›´æ–°ã•ã‚Œã‚‹ã€‚

### æ‰‹å‹•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´

`openShootStatusModal()` ã§æ‰‹å‹•ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é€²ã‚ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼ˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚ã‚Šï¼‰ã€‚

---

## 6. ãƒ¡ãƒ¼ãƒ«ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§

| ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå | ä»¶åãƒ‘ã‚¿ãƒ¼ãƒ³ | ç”¨é€” |
|---|---|---|
| æ‰“è¨ºãƒ¡ãƒ¼ãƒ« | `ã€ã”ç›¸è«‡ã€‘{ä½œå“å} / {å½¹å}å½¹` | å‡ºæ¼”å¯å¦ã®ç¢ºèª |
| é¦™ç›¤é€£çµ¡ | `ã€é¦™ç›¤é€£çµ¡ã€‘{ä½œå“å}` | æ’®å½±ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»å ´æ‰€ã®é€šçŸ¥ |
| ç™ºæ³¨æ›¸ | `ã€ç™ºæ³¨æ›¸é€ä»˜ã€‘{ä½œå“å}` | ç™ºæ³¨å†…å®¹ã®é€ä»˜ |
| ã‚ªãƒ•ã‚·ãƒ§ãƒƒãƒˆ_æ¡ˆä»¶ | `ã€ã‚ªãƒ•ã‚·ãƒ§ãƒƒãƒˆå…±æœ‰ã€‘{ä½œå“å}` | æ¡ˆä»¶æ’®å½±ã®ã‚ªãƒ•ã‚·ãƒ§ãƒƒãƒˆå…±æœ‰ |
| ã‚ªãƒ•ã‚·ãƒ§ãƒƒãƒˆ_éæ¡ˆä»¶ | `ã€ã‚ªãƒ•ã‚·ãƒ§ãƒƒãƒˆå…±æœ‰ã€‘{ä½œå“å}` | éæ¡ˆä»¶æ’®å½±ã®ã‚ªãƒ•ã‚·ãƒ§ãƒƒãƒˆå…±æœ‰ |
| æŠ•ç¨¿æ—¥é€£çµ¡ | `ã€æŠ•ç¨¿æ—¥é€£çµ¡ã€‘{ä½œå“å}` | æŠ•ç¨¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é€šçŸ¥ |

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè‡ªå‹•é¸æŠ

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | åˆæœŸé¸æŠãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |
|---|---|
| é¦™ç›¤é€£çµ¡å¾…ã¡ / æ±ºå®š / OK | é¦™ç›¤é€£çµ¡ |
| ç™ºæ³¨æ›¸é€ä¿¡å¾…ã¡ | ç™ºæ³¨æ›¸ |
| ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡ | ã‚ªãƒ•ã‚·ãƒ§ãƒƒãƒˆ_æ¡ˆä»¶ |
| æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡ | æŠ•ç¨¿æ—¥é€£çµ¡ |
| ã‚ªãƒ¼ãƒ€ãƒ¼å¾…ã¡ / æ‰“è¨ºä¸­ / ä»®ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚° | æ‰“è¨ºãƒ¡ãƒ¼ãƒ« |

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã®å¤‰æ•°ç½®æ›

| å¤‰æ•° | ç½®æ›å…ƒ |
|---|---|
| `{{æ’®å½±æ—¥}}` | `item.date` or `item.startDate` |
| `{{ã‚­ãƒ£ã‚¹ãƒˆå}}` | `item.castName` |
| `{{ä½œå“å}}` / `{{ä½œå“å1}}` | `item.projectName` |
| `{{å½¹å}}` / `{{é…å½¹1}}` | `item.roleName` |
| `{{é‡‘é¡}}` | `item.cost`ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰ |
| `{{æ™‚é–“}}` | `{inTime}ã€œ{outTime}` |
| `{{é›†åˆå ´æ‰€}}` | `item.location` |
| `{{notion}}` | Notion URLï¼ˆ`notionId` ã‹ã‚‰ãƒã‚¤ãƒ•ãƒ³é™¤å»ã—ã¦æ§‹ç¯‰ï¼‰ |
| `{{ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ}}` | `item.account` |

### ãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ©Ÿèƒ½

1. **Toæ¬„**: ã‚­ãƒ£ã‚¹ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¡¨ç¤º + ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
2. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåˆ‡æ›¿**: ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§åˆ‡æ›¿å¯èƒ½ã€ä»¶åãƒ»æœ¬æ–‡ãŒå³æ™‚åæ˜ 
3. **ä»¶åãƒ»æœ¬æ–‡**: è‡ªç”±ã«ç·¨é›†å¯èƒ½
4. **ã€Œã‚³ãƒ”ãƒ¼ã—ã¦é–‰ã˜ã‚‹ã€**: æœ¬æ–‡ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ â†’ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è‡ªå‹•ã§æ¬¡ã«é€²ã‚ã‚‹

---

## 7. GASåŒæœŸæ©Ÿèƒ½

### åŒæœŸã®ç¨®é¡

| ã‚¿ãƒ– | åŒæœŸã‚¿ã‚¤ãƒ— | GAS URL |
|---|---|---|
| é¦™ç›¤é€£çµ¡å¾…ã¡ | `schedule` | å›ºå®šURLï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰ |
| ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡ | `making` | å›ºå®šURLï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰ |
| æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡ | `post_date` | ç’°å¢ƒå¤‰æ•° `GAS_URL_POST_DATE` |

### åŒæœŸãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant FE as ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    participant API as ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
    participant GAS as Google Apps Script

    User->>FE: åŒæœŸãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    FE->>FE: confirm()ã§ç¢ºèª
    FE->>API: POST /api/sync/gas?type={syncType}
    API->>GAS: GET {GAS_URL}
    GAS->>GAS: å¤–éƒ¨DBã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—&æ’®å½±é€£çµ¡DBã«åæ˜ 
    GAS-->>API: { updatedRows: N }
    API-->>FE: { ok: true, gas_response: {...} }
    FE->>FE: loadShootingContactPage() ã§å†èª­ã¿è¾¼ã¿
    FE->>User: ã€ŒåŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸï¼ˆæ›´æ–°: Nä»¶ï¼‰ã€
```

### åŒæœŸå†…å®¹

| ã‚¿ã‚¤ãƒ— | GASã®å‡¦ç†å†…å®¹ |
|---|---|
| `schedule` | é¦™ç›¤DBï¼ˆåˆ¥ã‚·ãƒ¼ãƒˆï¼‰ã‹ã‚‰ IN/OUT æ™‚é–“ãƒ»å ´æ‰€ã‚’å–å¾—ã—ã€æ’®å½±é€£çµ¡DBã® K/L/M åˆ—ã«åæ˜  |
| `making` | ãƒ¡ã‚¤ã‚­ãƒ³ã‚°DBï¼ˆåˆ¥ã‚·ãƒ¼ãƒˆï¼‰ã‹ã‚‰ãƒ¡ã‚¤ã‚­ãƒ³ã‚°URLã‚’å–å¾—ã—ã€Oåˆ—ã«åæ˜  |
| `post_date` | æŠ•ç¨¿æ—¥DBï¼ˆåˆ¥ã‚·ãƒ¼ãƒˆï¼‰ã‹ã‚‰æŠ•ç¨¿æ—¥ã‚’å–å¾—ã—ã€Qåˆ—ã«åæ˜  |

---

## 8. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API

### `GET /api/shooting_contact/list`

æ’®å½±é€£çµ¡DBã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã€‚

| é …ç›® | å€¤ |
|---|---|
| ãƒ¬ã‚¹ãƒãƒ³ã‚¹ | `Array<ShootingContactItem>` |
| ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ | `æ’®å½±é€£çµ¡DB` ã‚·ãƒ¼ãƒˆã®å…¨è¡Œï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼é™¤ãï¼‰ |

### `POST /api/shooting_contact/add`

æ–°è¦ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã€‚

| é …ç›® | å€¤ |
|---|---|
| å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | `castingId`, `account`, `projectName`, `notionId`, `roleName`, `castName`, `castType`, `shootDate` |
| åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | `é¦™ç›¤é€£çµ¡å¾…ã¡` |
| å‡¦ç† | ã‚·ãƒ¼ãƒˆã«1è¡Œè¿½åŠ ï¼ˆ`append_row`ï¼‰ |

### `POST /api/shooting_contact/update`

æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã®éƒ¨åˆ†æ›´æ–°ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ« (`ShootingContactUpdateItem`):**

```python
class ShootingContactUpdateItem(BaseModel):
    castingId: str           # å¿…é ˆï¼ˆæ¤œç´¢ã‚­ãƒ¼ï¼‰
    status: Optional[str]    # Jåˆ—
    inTime: Optional[str]    # Kåˆ—
    outTime: Optional[str]   # Låˆ—
    location: Optional[str]  # Måˆ—
    address: Optional[str]   # Nåˆ—
    cost: Optional[str]      # Påˆ—
    makingUrl: Optional[str] # Oåˆ—
    postDate: Optional[str]  # Qåˆ—
    mainSub: Optional[str]   # Tåˆ—
    poUuid: Optional[str]    # Uåˆ—
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
1. Aåˆ—ã‹ã‚‰ `castingId` ã§è¡Œã‚’æ¤œç´¢
2. æŒ‡å®šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ `batch_update` ã§æ›´æ–°
3. Såˆ—ã«ç¾åœ¨æ—¥æ™‚ã‚’è‡ªå‹•è¨˜éŒ²
4. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ `ãƒ¡ã‚¤ã‚­ãƒ³ã‚°å…±æœ‰å¾…ã¡ â†’ æŠ•ç¨¿æ—¥é€£çµ¡å¾…ã¡` ã®å ´åˆ**: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã® Påˆ—ï¼ˆpoUuidï¼‰ã¨ Oåˆ—ï¼ˆcostï¼‰ã‚‚åŒæœŸ

### `POST /api/sync/gas`

GASã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦å¤–éƒ¨DBã¨åŒæœŸã€‚

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å€¤ |
|---|---|
| `type` | `schedule` / `making` / `post_date` |

---

## 9. ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒˆãƒªã‚¬ãƒ¼

### æ’®å½±é€£çµ¡DBã¸ã®è‡ªå‹•ç™»éŒ²

ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œæ±ºå®šã€ã€ŒOKã€ã«ãªã£ãŸæ™‚ã€**å¤–éƒ¨ã‚­ãƒ£ã‚¹ãƒˆ**ã®ã¿è‡ªå‹•ã§æ’®å½±é€£çµ¡DBã«ç™»éŒ²ã•ã‚Œã‚‹ã€‚

```mermaid
flowchart TD
    A[changeCastingStatus] --> B{æ–°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ = æ±ºå®š/OK?}
    B -->|No| C[ä½•ã‚‚ã—ãªã„]
    B -->|Yes| D{å¤–éƒ¨ã‚­ãƒ£ã‚¹ãƒˆ?}
    D -->|No| E[å†…éƒ¨ã‚­ãƒ£ã‚¹ãƒˆ: DBç™»éŒ²ã‚¹ã‚­ãƒƒãƒ—]
    D -->|Yes| F{dbSentStatus = æ¸ˆ?}
    F -->|Yes| G[é‡è¤‡é˜²æ­¢: ã‚¹ã‚­ãƒƒãƒ—]
    F -->|No| H[POST /api/shooting_contact/add]
    H --> I[ã‚­ãƒ£ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚¹ãƒˆã®Xåˆ—ã‚’ã€Œæ¸ˆã€ã«æ›´æ–°]
```

| æ¡ä»¶ | ç™»éŒ² |
|---|---|
| å¤–éƒ¨ã‚­ãƒ£ã‚¹ãƒˆ + æ±ºå®š/OK + æœªç™»éŒ²ï¼ˆXåˆ—â‰ æ¸ˆï¼‰ | âœ… |
| å†…éƒ¨ã‚­ãƒ£ã‚¹ãƒˆ | âŒ |
| æ—¢ã«ç™»éŒ²æ¸ˆã¿ï¼ˆXåˆ—=æ¸ˆï¼‰ | âŒï¼ˆé‡è¤‡é˜²æ­¢ï¼‰ |

---

## é–¢é€£ã‚³ãƒ¼ãƒ‰å‚ç…§

| é–¢æ•°å | ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œç•ªå· | å½¹å‰² |
|---|---|---|---|
| [showShootContactPage](file:///Users/mk0012/Desktop/casting-management-system-v1/templates/index.html#L3760-L3796) | index.html | L3760-3796 | ãƒšãƒ¼ã‚¸åˆæœŸåŒ–ãƒ»ã‚¿ãƒ–æç”» |
| [loadShootingContactPage](file:///Users/mk0012/Desktop/casting-management-system-v1/templates/index.html#L3798-L3939) | index.html | L3798-3939 | APIå–å¾—ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ»ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ãƒ»æç”» |
| [renderProjectTable](file:///Users/mk0012/Desktop/casting-management-system-v1/templates/index.html#L3949-L4107) | index.html | L3949-4107 | ã‚¿ãƒ–åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ |
| [saveShootingRow](file:///Users/mk0012/Desktop/casting-management-system-v1/templates/index.html#L4140-L4192) | index.html | L4140-4192 | è¡Œå†…ã®ç·¨é›†ãƒ‡ãƒ¼ã‚¿ä¿å­˜ |
| [openShootMailModal](file:///Users/mk0012/Desktop/casting-management-system-v1/templates/index.html#L4580-L4869) | index.html | L4580-4869 | ãƒ¡ãƒ¼ãƒ«ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆ6ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ |
| [copyToClipboardAndClose](file:///Users/mk0012/Desktop/casting-management-system-v1/templates/index.html#L4871-L4913) | index.html | L4871-4913 | ã‚³ãƒ”ãƒ¼ï¼‹è‡ªå‹•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é€²è¡Œ |
| [syncShootingSchedule](file:///Users/mk0012/Desktop/casting-management-system-v1/templates/index.html#L4977-L5015) | index.html | L4977-5015 | GASåŒæœŸå®Ÿè¡Œ |
| [shooting_contact_list](file:///Users/mk0012/Desktop/casting-management-system-v1/main.py#L911-L974) | main.py | L911-974 | ãƒ‡ãƒ¼ã‚¿å–å¾—API |
| [add_shooting_contact](file:///Users/mk0012/Desktop/casting-management-system-v1/main.py#L975-L1021) | main.py | L975-1021 | ãƒ‡ãƒ¼ã‚¿è¿½åŠ API |
| [update_shooting_contact_status](file:///Users/mk0012/Desktop/casting-management-system-v1/main.py#L1023-L1103) | main.py | L1023-1103 | ãƒ‡ãƒ¼ã‚¿æ›´æ–°APIï¼ˆ+ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿åŒæœŸï¼‰ |
| [sync_gas_trigger](file:///Users/mk0012/Desktop/casting-management-system-v1/main.py#L1105-L1131) | main.py | L1105-1131 | GASåŒæœŸAPI |
