# vue_casty 現在の実装仕様書

## 概要

vue_castyは、キャスティング業務を管理するためのWebアプリケーションです。Vue 3 + TypeScript + Firebase (Firestore) で構築されています。

---

## 1. 認証・ユーザー管理

### 実装状況: ✅ 動作確認済み

| 機能 | 説明 |
|-----|-----|
| ログイン | Firebase Authenticationによる認証 |
| ユーザー表示 | ヘッダーに現在のログインユーザー名を表示 |
| 権限管理 | 管理者(`isAdmin`)と一般ユーザーで機能を分離 |

---

## 2. キャストを探す (CastingView)

### 実装状況: ✅ 全機能動作確認済み

### 2.1 カレンダー機能
日付を選択してキャスト検索を開始します。

- **開始日・終了日の範囲選択**が可能
- **カレンダーがカード枠内に収まる**バグ修正済み
- 日付を選択しないとキャスト一覧は表示されない（ガード機能）

### 2.2 フィルター機能
複数の条件で絞り込みが可能です。

| フィルター | 説明 |
|-----------|-----|
| **テキスト検索** | キャスト名・事務所名・ふりがなで検索 |
| **タイプ** | すべて / 内部 / 外部 |
| **性別** | 男性 / 女性（チェックボックス） |
| **事務所** | マルチセレクトで複数選択可 |
| **未仮キャスのみ** | 仮押さえされていないキャストのみ表示 |
| **ソート** | 最新 / 出演回数 / 50音順 |

### 2.3 表示モード切替
画面右上のトグルで切り替え可能。

- **3列モード**: 詳細重視、カードが大きく表示
- **5列モード**: 一覧性重視、より多くのキャストを表示

### 2.4 カート機能
キャストを選択してオーダーを作成します。

1. キャストカードをクリック → 詳細モーダル表示
2. 「カートに追加」ボタンでカートに追加
3. カートアイコンをクリック → サイドバー表示
4. 案件タイプを選択（通常案件 / 外部案件）
5. 案件名・クライアント名などを入力
6. 「オーダー送信」ボタンで送信

### 2.5 プログレスモーダル
オーダー送信時に進捗を表示。

- Firestoreへの保存状況
- Slack通知の送信状況（※localhost環境ではCORSエラー）
- 完了/エラー状態の表示

---

## 3. キャスティング状況 (CastingStatusView)

### 実装状況: ✅ 全機能動作確認済み

### 3.1 表示形式
日付・案件ごとのアコーディオン形式（ツリー構造）で表示。

```
📅 2026/02/04
  └─ 案件名A by 担当者
      ├─ キャストA [オーダー待ち]
      ├─ キャストB [仮押さえ]
      └─ キャストC [決定]
```

### 3.2 タブ切替
| タブ | 内容 |
|-----|-----|
| **通常案件** | クライアント向けの一般案件 |
| **外部案件・社内イベント** | 社内イベントや外部向け案件 |

### 3.3 フィルター
- **オーダー待ちのみ**: 未決定のキャスティングのみ表示
- **過去を表示**: 過去の案件も含めて表示

### 3.4 ステータス管理
各行のステータスバッジをクリックして変更可能。

| ステータス | 色 |
|-----------|-----|
| 仮押さえ | グレー |
| ホールド | 黄色 |
| 問合せ中 | 青 |
| オーダー待ち | 紫 |
| OK | 緑（薄） |
| 決定 | 緑（濃） |
| 条件つきOK | オレンジ |
| NG | 赤 |
| キャンセル | グレー（濃） |

### 3.5 アクションボタン
- **追加オーダー**: 同一案件に追加キャストをオーダー
- **まとめ**: プロジェクト全体のサマリー（管理者のみ）
- **メール**: 外部キャストへのメール送信（外部案件タブのみ）
- **Slackを開く**: 関連するSlackスレッドを開く
- **削除**: キャスティングを削除（管理者のみ）

---

## 4. 撮影連絡DB (ShootingContactView)

### 実装状況: ✅ 基本機能動作確認済み

### 4.1 フェーズ管理
撮影準備の進捗に応じたタブ管理。

| タブ | 説明 |
|-----|-----|
| 香盤連絡待ち | スケジュール連絡待ち |
| 発注書送信待ち | 発注書の送信待ち |
| メイキング共有待ち | 撮影後のメイキング共有待ち |
| 完了 | 全工程完了 |

---

## 5. 管理画面

### 実装状況: ⚠️ 準備中（プレースホルダー表示）

現在は「準備中」のメッセージが表示されます。

---

## 6. 技術仕様

### 6.1 フロントエンド
- **フレームワーク**: Vue 3 (Composition API)
- **言語**: TypeScript
- **UIライブラリ**: PrimeVue
- **状態管理**: Pinia

### 6.2 バックエンド
- **データベース**: Firebase Firestore
- **認証**: Firebase Authentication
- **通知**: Slack API（Cloud Functions経由を推奨）

### 6.3 主要コレクション（Firestore）
| コレクション | 用途 |
|-------------|-----|
| `casts` | キャスト情報 |
| `castings` | キャスティング（オーダー）情報 |
| `shootings` | 撮影案件情報 |
| `shootingContacts` | 撮影連絡情報 |
| `castMaster` | キャスト履歴（出演回数など） |

---

## 7. 既知の制限事項

| 項目 | 説明 |
|-----|-----|
| **Slack通知** | localhost環境ではCORSエラー。本番はCloud Functions経由を推奨 |
| **Google Calendar連携** | 環境変数未設定のため動作しない |
| **管理画面** | 未実装（プレースホルダー） |

---

## 8. 動作確認結果

![ブラウザ検証録画](/Users/mk0012/.gemini/antigravity/brain/efe2bff0-a092-4681-8e1f-35329cd4dad9/full_site_verification_1770175948746.webp)

全ての主要機能について動作確認を実施し、正常に動作することを確認しました。
